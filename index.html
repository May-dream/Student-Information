<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>学生信息采集</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://cdn.jsdelivr.net/npm/font-awesome@4.7.0/css/font-awesome.min.css" rel="stylesheet">
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        primary: '#3B82F6',
                        secondary: '#10B981',
                        warning: '#F59E0B',
                        danger: '#EF4444',
                        light: '#F3F4F6',
                        dark: '#1F2937'
                    },
                    fontFamily: {
                        sans: ['Inter', 'system-ui', 'sans-serif'],
                    },
                }
            }
        }
    </script>
    <style type="text/tailwindcss">
        @layer utilities {
            .form-input-focus {
                @apply focus:ring-2 focus:ring-primary/50 focus:border-primary focus:outline-none;
            }
            .form-label {
                @apply block text-sm font-medium text-gray-700 mb-1;
            }
            .form-input {
                @apply w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm form-input-focus transition duration-200;
            }
            .error-message {
                @apply text-danger text-xs mt-1 hidden;
            }
            .toast {
                @apply fixed top-4 right-4 px-6 py-3 rounded-lg shadow-lg transform transition-all duration-300 opacity-0 translate-y-[-20px] pointer-events-none;
            }
            .toast.show {
                @apply opacity-100 translate-y-0 pointer-events-auto;
            }
            .toast-success {
                @apply bg-secondary text-white;
            }
            .toast-error {
                @apply bg-danger text-white;
            }
        }
    </style>
</head>
<body class="bg-gray-50 min-h-screen">
    <div class="container mx-auto px-4 py-8 max-w-3xl">
        <div class="bg-white rounded-xl shadow-md p-6 md:p-8 mb-6">
            <div class="text-center mb-8">
                <h1 class="text-[clamp(1.5rem,3vw,2rem)] font-bold text-dark mb-2">学生信息采集表</h1>
                <p class="text-gray-500">请准确填写以下信息，带 <span class="text-danger">*</span> 为必填项</p>
            </div>

            <form id="studentForm" class="space-y-5">
                <!-- 序号 -->
                <div class="form-group">
                    <label for="serialNumber" class="form-label">序号 <span class="text-danger">*</span></label>
                    <input type="number" id="serialNumber" name="serialNumber" class="form-input" required>
                    <div class="error-message" id="serialNumberError">请输入序号</div>
                </div>

                <!-- 姓名 -->
                <div class="form-group">
                    <label for="name" class="form-label">姓名 <span class="text-danger">*</span></label>
                    <input type="text" id="name" name="name" class="form-input" required>
                    <div class="error-message" id="nameError">请输入姓名</div>
                </div>

                <!-- 专业 -->
                <div class="form-group">
                    <label for="major" class="form-label">专业 <span class="text-danger">*</span></label>
                    <input type="text" id="major" name="major" class="form-input" required>
                    <div class="error-message" id="majorError">请输入专业</div>
                </div>

                <!-- 所在班级 -->
                <div class="form-group">
                    <label for="className" class="form-label">所在班级 <span class="text-danger">*</span></label>
                    <input type="text" id="className" name="className" class="form-input" required>
                    <div class="error-message" id="classNameError">请输入班级</div>
                </div>

                <!-- 学号 -->
                <div class="form-group">
                    <label for="studentId" class="form-label">学号 <span class="text-danger">*</span></label>
                    <input type="text" id="studentId" name="studentId" class="form-input" required>
                    <div class="error-message" id="studentIdError">请输入学号</div>
                </div>

                <!-- 性别 -->
                <div class="form-group">
                    <label class="form-label">性别 <span class="text-danger">*</span></label>
                    <div class="flex space-x-4">
                        <label class="inline-flex items-center">
                            <input type="radio" name="gender" value="男" class="form-radio text-primary" required>
                            <span class="ml-2">男</span>
                        </label>
                        <label class="inline-flex items-center">
                            <input type="radio" name="gender" value="女" class="form-radio text-primary">
                            <span class="ml-2">女</span>
                        </label>
                    </div>
                    <div class="error-message" id="genderError">请选择性别</div>
                </div>

                <!-- 民族 -->
                <div class="form-group">
                    <label for="nationality" class="form-label">民族 <span class="text-danger">*</span></label>
                    <input type="text" id="nationality" name="nationality" class="form-input" required>
                    <div class="error-message" id="nationalityError">请输入民族</div>
                </div>

                <!-- 身份证号 -->
                <div class="form-group">
                    <label for="idCard" class="form-label">身份证号 <span class="text-danger">*</span></label>
                    <input type="text" id="idCard" name="idCard" class="form-input" required 
                           placeholder="请输入18位身份证号，末尾字母X需大写">
                    <div class="error-message" id="idCardError">
                        身份证号格式错误，请输入18位有效身份证号，末尾字母X需大写
                    </div>
                </div>

                <!-- 出生年月 -->
                <div class="form-group">
                    <label for="birthDate" class="form-label">出生年月 <span class="text-danger">*</span></label>
                    <input type="text" id="birthDate" name="birthDate" class="form-input" required 
                           placeholder="格式：xx年xx月xx日">
                    <div class="error-message" id="birthDateError">
                        出生日期格式错误，请使用xx年xx月xx日格式，例如：2000年01月01日
                    </div>
                </div>

                <!-- 宿舍 -->
                <div class="form-group">
                    <label for="dormitory" class="form-label">宿舍 <span class="text-danger">*</span></label>
                    <input type="text" id="dormitory" name="dormitory" class="form-input" required>
                    <div class="error-message" id="dormitoryError">请输入宿舍信息</div>
                </div>

                <!-- 家庭经济情况 -->
                <div class="form-group">
                    <label for="economicStatus" class="form-label">家庭经济情况 <span class="text-danger">*</span></label>
                    <input type="text" id="economicStatus" name="economicStatus" class="form-input" required>
                    <div class="error-message" id="economicStatusError">请输入家庭经济情况</div>
                </div>

                <!-- 户籍性质 -->
                <div class="form-group">
                    <label for="householdType" class="form-label">户籍性质 <span class="text-danger">*</span></label>
                    <select id="householdType" name="householdType" class="form-input" required>
                        <option value="">请选择</option>
                        <option value="农村">农村</option>
                        <option value="城市">城市</option>
                    </select>
                    <div class="error-message" id="householdTypeError">请选择户籍性质（农村或城市）</div>
                </div>

                <!-- 籍贯 -->
                <div class="form-group">
                    <label for="nativePlace" class="form-label">籍贯 <span class="text-danger">*</span></label>
                    <input type="text" id="nativePlace" name="nativePlace" class="form-input" required>
                    <div class="error-message" id="nativePlaceError">请输入籍贯</div>
                </div>

                <!-- 家庭住址 -->
                <div class="form-group">
                    <label for="homeAddress" class="form-label">家庭住址 <span class="text-danger">*</span></label>
                    <input type="text" id="homeAddress" name="homeAddress" class="form-input" required>
                    <div class="error-message" id="homeAddressError">请输入家庭住址</div>
                </div>

                <!-- 手机号 -->
                <div class="form-group">
                    <label for="phone" class="form-label">手机号 <span class="text-danger">*</span></label>
                    <input type="text" id="phone" name="phone" class="form-input" required placeholder="请输入11位手机号码">
                    <div class="error-message" id="phoneError">请输入11位有效手机号码</div>
                </div>

                <!-- 父亲名字 -->
                <div class="form-group">
                    <label for="fatherName" class="form-label">父亲名字 <span class="text-danger">*</span></label>
                    <input type="text" id="fatherName" name="fatherName" class="form-input" required>
                    <div class="error-message" id="fatherNameError">请输入父亲名字</div>
                </div>

                <!-- 父亲手机号 -->
                <div class="form-group">
                    <label for="fatherPhone" class="form-label">父亲手机号 <span class="text-danger">*</span></label>
                    <input type="text" id="fatherPhone" name="fatherPhone" class="form-input" required>
                    <div class="error-message" id="fatherPhoneError">请输入父亲的11位有效手机号码</div>
                </div>

                <!-- 母亲姓名 -->
                <div class="form-group">
                    <label for="motherName" class="form-label">母亲姓名 <span class="text-danger">*</span></label>
                    <input type="text" id="motherName" name="motherName" class="form-input" required>
                    <div class="error-message" id="motherNameError">请输入母亲姓名</div>
                </div>

                <!-- 母亲手机号 -->
                <div class="form-group">
                    <label for="motherPhone" class="form-label">母亲手机号 <span class="text-danger">*</span></label>
                    <input type="text" id="motherPhone" name="motherPhone" class="form-input" required>
                    <div class="error-message" id="motherPhoneError">请输入母亲的11位有效手机号码</div>
                </div>

                <!-- QQ号 -->
                <div class="form-group">
                    <label for="qq" class="form-label">QQ号 <span class="text-danger">*</span></label>
                    <input type="text" id="qq" name="qq" class="form-input" required>
                    <div class="error-message" id="qqError">请输入QQ号</div>
                </div>

                <!-- 政治面貌 -->
                <div class="form-group">
                    <label for="politicalStatus" class="form-label">政治面貌 <span class="text-danger">*</span></label>
                    <select id="politicalStatus" name="politicalStatus" class="form-input" required>
                        <option value="">请选择</option>
                        <option value="中共党员">中共党员</option>
                        <option value="共青团员">共青团员</option>
                        <option value="群众">群众</option>
                    </select>
                    <div class="error-message" id="politicalStatusError">请选择政治面貌（中共党员、共青团员、群众）</div>
                </div>

                <!-- 特长 -->
                <div class="form-group">
                    <label for="specialty" class="form-label">特长 <span class="text-danger">*</span></label>
                    <input type="text" id="specialty" name="specialty" class="form-input" required>
                    <div class="error-message" id="specialtyError">请输入特长</div>
                </div>

                <!-- 宗教信仰 -->
                <div class="form-group">
                    <label for="religion" class="form-label">宗教信仰 <span class="text-danger">*</span></label>
                    <input type="text" id="religion" name="religion" class="form-input" required>
                    <div class="error-message" id="religionError">请输入宗教信仰</div>
                </div>

                <!-- 提交按钮 -->
                <div class="pt-4">
                    <button type="submit" id="submitBtn" class="w-full bg-primary hover:bg-primary/90 text-white font-medium py-3 px-4 rounded-md transition duration-200 flex items-center justify-center">
                        <i class="fa fa-check mr-2"></i> 提交信息
                    </button>
                </div>
            </form>
        </div>

        <div class="text-center text-gray-500 text-sm mb-8">
            <p>提交后将自动保存您的信息，感谢您的配合</p>
        </div>
    </div>

    <!-- 提示消息组件 -->
    <div id="toast" class="toast">
        <span id="toastMessage"></span>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', function() {
            const form = document.getElementById('studentForm');
            const submitBtn = document.getElementById('submitBtn');
            const toast = document.getElementById('toast');
            const toastMessage = document.getElementById('toastMessage');

            // 显示提示消息
            function showToast(message, isSuccess = true) {
                toastMessage.textContent = message;
                toast.className = 'toast ' + (isSuccess ? 'toast-success' : 'toast-error');
                setTimeout(() => {
                    toast.classList.add('show');
                }, 10);
                
                // 3秒后自动隐藏
                setTimeout(() => {
                    toast.classList.remove('show');
                }, 3000);
            }

            // 表单提交处理
            form.addEventListener('submit', function(e) {
                e.preventDefault();
                let isValid = true;

                // 验证各个字段
                isValid = validateRequiredField('serialNumber') && isValid;
                isValid = validateRequiredField('name') && isValid;
                isValid = validateRequiredField('major') && isValid;
                isValid = validateRequiredField('className') && isValid;
                isValid = validateRequiredField('studentId') && isValid;
                isValid = validateGender() && isValid;
                isValid = validateRequiredField('nationality') && isValid;
                isValid = validateIdCard() && isValid;
                isValid = validateBirthDate() && isValid;
                isValid = validateRequiredField('dormitory') && isValid;
                isValid = validateRequiredField('economicStatus') && isValid;
                isValid = validateSelectField('householdType') && isValid;
                isValid = validateRequiredField('nativePlace') && isValid;
                isValid = validateRequiredField('homeAddress') && isValid;
                isValid = validatePhone('phone') && isValid;
                isValid = validateRequiredField('fatherName') && isValid;
                isValid = validatePhone('fatherPhone') && isValid;
                isValid = validateRequiredField('motherName') && isValid;
                isValid = validatePhone('motherPhone') && isValid;
                isValid = validateRequiredField('qq') && isValid;
                isValid = validateSelectField('politicalStatus') && isValid;
                isValid = validateRequiredField('specialty') && isValid;
                isValid = validateRequiredField('religion') && isValid;

                // 如果验证通过，发送数据到服务器
                if (isValid) {
                    // 显示加载状态
                    submitBtn.disabled = true;
                    submitBtn.innerHTML = '<i class="fa fa-spinner fa-spin mr-2"></i> 提交中...';

                    // 收集表单数据
                    const formData = new FormData(form);
                    const data = Object.fromEntries(formData.entries());

                    // 发送数据到服务器
                    fetch('/submit', {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json',
                        },
                        body: JSON.stringify(data)
                    })
                    .then(response => {
                        if (!response.ok) {
                            throw new Error('网络响应不正常');
                        }
                        return response.json();
                    })
                    .then(result => {
                        if (result.success) {
                            showToast('提交成功！感谢您的配合。');
                            form.reset(); // 重置表单
                        } else {
                            showToast(result.message || '提交失败，请重试', false);
                        }
                    })
                    .catch(error => {
                        console.error('提交错误:', error);
                        showToast('提交失败，请检查网络连接后重试', false);
                    })
                    .finally(() => {
                        // 恢复按钮状态
                        submitBtn.disabled = false;
                        submitBtn.innerHTML = '<i class="fa fa-check mr-2"></i> 提交信息';
                    });
                } else {
                    // 滚动到第一个错误字段
                    const firstError = document.querySelector('.error-message:not(.hidden)');
                    if (firstError) {
                        firstError.scrollIntoView({ behavior: 'smooth', block: 'center' });
                    }
                }
            });

            // 为输入框添加实时验证
            const inputs = form.querySelectorAll('input, select');
            inputs.forEach(input => {
                input.addEventListener('blur', function() {
                    const id = this.id;
                    switch(id) {
                        case 'idCard':
                            validateIdCard();
                            break;
                        case 'birthDate':
                            validateBirthDate();
                            break;
                        case 'phone':
                        case 'fatherPhone':
                        case 'motherPhone':
                            validatePhone(id);
                            break;
                        case 'gender':
                            validateGender();
                            break;
                        case 'householdType':
                        case 'politicalStatus':
                            validateSelectField(id);
                            break;
                        default:
                            if (this.hasAttribute('required')) {
                                validateRequiredField(id);
                            }
                    }
                });
            });

            // 验证必填字段
            function validateRequiredField(fieldId) {
                const field = document.getElementById(fieldId);
                const errorElement = document.getElementById(`${fieldId}Error`);
                
                if (!field.value.trim()) {
                    showError(errorElement);
                    return false;
                } else {
                    hideError(errorElement);
                    return true;
                }
            }

            // 验证性别选择
            function validateGender() {
                const genderSelected = document.querySelector('input[name="gender"]:checked');
                const errorElement = document.getElementById('genderError');
                
                if (!genderSelected) {
                    showError(errorElement);
                    return false;
                } else {
                    hideError(errorElement);
                    return true;
                }
            }

            // 验证下拉选择字段
            function validateSelectField(fieldId) {
                const field = document.getElementById(fieldId);
                const errorElement = document.getElementById(`${fieldId}Error`);
                
                if (!field.value) {
                    showError(errorElement);
                    return false;
                } else {
                    hideError(errorElement);
                    return true;
                }
            }

            // 验证身份证号
            function validateIdCard() {
                const idCard = document.getElementById('idCard').value.trim();
                const errorElement = document.getElementById('idCardError');
                // 18位身份证号正则，最后一位可以是数字或大写X
                const idCardRegex = /^[1-9]\d{5}(19|20)\d{2}(0[1-9]|1[0-2])(0[1-9]|[12]\d|3[01])\d{3}[\dX]$/;
                
                if (!idCard || idCard.length !== 18 || !idCardRegex.test(idCard)) {
                    showError(errorElement);
                    return false;
                } else {
                    hideError(errorElement);
                    return true;
                }
            }

            // 验证出生日期格式
            function validateBirthDate() {
                const birthDate = document.getElementById('birthDate').value.trim();
                const errorElement = document.getElementById('birthDateError');
                // 匹配xx年xx月xx日格式
                const dateRegex = /^\d{2,4}年(0[1-9]|1[0-2])月(0[1-9]|[12]\d|3[01])日$/;
                
                if (!birthDate || !dateRegex.test(birthDate)) {
                    showError(errorElement);
                    return false;
                } else {
                    hideError(errorElement);
                    return true;
                }
            }

            // 验证手机号
            function validatePhone(fieldId) {
                const phone = document.getElementById(fieldId).value.trim();
                const errorElement = document.getElementById(`${fieldId}Error`);
                // 11位数字手机号正则
                const phoneRegex = /^1[3-9]\d{9}$/;
                
                if (!phone || phone.length !== 11 || !phoneRegex.test(phone)) {
                    showError(errorElement);
                    return false;
                } else {
                    hideError(errorElement);
                    return true;
                }
            }

            // 显示错误信息
            function showError(element) {
                element.classList.remove('hidden');
                element.parentElement.querySelector('input, select').classList.add('border-danger');
                element.parentElement.querySelector('input, select').classList.remove('border-gray-300');
            }

            // 隐藏错误信息
            function hideError(element) {
                element.classList.add('hidden');
                element.parentElement.querySelector('input, select').classList.remove('border-danger');
                element.parentElement.querySelector('input, select').classList.add('border-gray-300');
            }
        });
    </script>
</body>
</html>
